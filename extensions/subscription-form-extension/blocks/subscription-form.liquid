<div class="subscription-builder" id="subscription-form-{{ section.id }}">
  <div class="step-indicator">
    <div class="step active" data-step="1">1</div>
    <div class="step" data-step="2">2</div>
    <div class="step" data-step="3">3</div>
    <div class="step" data-step="4">4</div>
  </div>

  <!-- Paso 1: Tipo de suscripción -->
  <div class="form-step active" data-step="1">
    <h2>Choose your plan</h2>
    <div class="subscription-types">
      <label class="subscription-option">
        <input type="radio" name="subscription_type" value="curated">
        <div class="option-content">
          <div class="option-image">imagen caja</div>
          <h3>Curated Box</h3>
          <p>• Perfect for individuals and couples<br>• Up to ___ portions of ___ lbs of your choice</p>
        </div>
      </label>

      <label class="subscription-option">
        <input type="radio" name="subscription_type" value="custom">
        <div class="option-content">
          <div class="option-image">imagen caja</div>
          <h3>Custom Box</h3>
          <p>• Build your own box<br>• Choose your favorite cuts<br>• Save more with more products</p>
        </div>
      </label>
    </div>
    <div class="step-buttons center">
      <button class="next-step" data-next="2">Next</button>
    </div>
  </div>

  <!-- Paso 2: Tamaño de caja (solo para Curated) -->
  <div class="form-step" data-step="2">
    <h2>Select box size</h2>
    <div class="box-sizes">
      <label class="box-option">
        <input type="radio" name="box_size" value="small">
        <div class="box-info">
          <div class="box-image">imagen caja</div>
          <div class="box-details">
            <h4>Small Box</h4>
            <ul>
              <li>Perfect for individuals and couples</li>
              <li>Up to ___ portions of ___ lbs of your choice</li>
            </ul>
          </div>
        </div>
        <div class="box-price">$___</div>
      </label>

      <label class="box-option recommended">
        <input type="radio" name="box_size" value="medium">
        <div class="box-info">
          <div class="box-image">imagen caja</div>
          <div class="box-details">
            <h4>Medium Box</h4>
            <ul>
              <li>Perfect for small families</li>
              <li>Up to ___ portions of ___ lbs of your choice</li>
            </ul>
          </div>
        </div>
        <div class="box-price">$___</div>
      </label>

      <label class="box-option">
        <input type="radio" name="box_size" value="big">
        <div class="box-info">
          <div class="box-image">imagen caja</div>
          <div class="box-details">
            <h4>Premium Box</h4>
            <ul>
              <li>Perfect for mid-sized families.</li>
              <li>Up to ___ portions of ___ lbs of your choice</li>
            </ul>
          </div>
        </div>
        <div class="box-price">$___</div>
      </label>
    </div>
    <div class="step-buttons">
      <button class="prev-step" data-prev="1">Previous</button>
      <button class="next-step" data-next="3">Next</button>
    </div>
  </div>

  <!-- Paso 3: Frecuencia -->
  <div class="form-step" data-step="3">
    <h2>Frequency</h2>
    <p>Pause or cancel anytime.</p>
    <div class="frequency-options">
      <div class="frequency-option">
        <input type="radio" name="frequency" value="2weeks" id="freq-2weeks">
        <label for="freq-2weeks">Every 2 weeks</label>
      </div>

      <div class="frequency-option">
        <input type="radio" name="frequency" value="4weeks" id="freq-4weeks" checked>
        <label for="freq-4weeks">Every 4 weeks</label>
      </div>

      <div class="frequency-option">
        <input type="radio" name="frequency" value="8weeks" id="freq-8weeks">
        <label for="freq-8weeks">Every 8 weeks</label>
      </div>

      <div class="frequency-option">
        <input type="radio" name="frequency" value="12weeks" id="freq-12weeks">
        <label for="freq-12weeks">Every 12 weeks</label>
        <div class="frequency-note">Recommended for big freezers</div>
      </div>
    </div>
    <div class="step-buttons">
      <button class="prev-step" data-prev="2">Previous</button>
      <button class="next-step" data-next="4">Next</button>
    </div>
  </div>

  <!-- Paso 4: Select Products (solo para Custom) -->
  <div class="form-step" data-step="4">
    <div class="products-header">
      <h2>Select Cuts</h2>
      <p>Add more, save more. You can change your cuts month to month</p>

      <!-- Barra de progreso de descuento -->
      <div class="discount-progress">
        <div class="discount-progress-bar"></div>
        <div class="discount-milestones">
          <div class="discount-milestone" data-threshold="6">
            <span class="milestone-dot">✓</span>
            <span>Add 6, get 5% OFF</span>
          </div>
          <div class="discount-milestone" data-threshold="10">
            <span class="milestone-dot">✓</span>
            <span>Add 10, get 10% OFF</span>
            <span class="discount-label">Best Value</span>
          </div>
        </div>
      </div>
    </div>

    <div class="products-container">
      <!-- Sidebar de categorías -->
      <div class="categories-sidebar">
        <!-- Las categorías se cargarán dinámicamente -->
      </div>

      <!-- Grid de productos -->
      <div class="products-grid">
        <div class="loading-products">
          <p>Loading products...</p>
        </div>
        <!-- Los productos se cargarán dinámicamente aquí -->
      </div>
    </div>

    <div class="step-buttons">
      <button class="prev-step" data-prev="3">Previous</button>
      <div class="products-counter">
        <span id="selected-count">0</span> selected
        <span id="discount-info" style="display: none;"></span>
      </div>
      <button class="create-subscription" id="create-subscription" disabled>Select products</button>
    </div>
  </div>

  <!-- Loading y Success States -->
  <div class="loading-state" style="display: none;">
    <div class="loading-spinner"></div>
    <h3>Creating your subscription...</h3>
    <p>Please wait while we set up your custom box</p>
  </div>

  <div class="success-state" style="display: none;">
    <div class="success-icon">✓</div>
    <h2>Subscription Created Successfully!</h2>
    <p>Redirecting you to checkout to complete your first order...</p>
    <div class="subscription-summary-final">
      <h4>Your Selection:</h4>
      <div id="final-summary"></div>
    </div>
  </div>
</div>

{{ 'subscription-form.css' | asset_url | stylesheet_tag }}
<script src="{{ 'subscription-form.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Subscription Builder",
  "target": "section",
  "stylesheet": "subscription-form.css",
  "javascript": "subscription-form.js",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Form Title",
      "default": "Create your subscription"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Form Description",
      "default": "Configure your personalized subscription in simple steps"
    }
  ]
}
{% endschema %}
