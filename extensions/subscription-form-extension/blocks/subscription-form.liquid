<div class="subscription-builder" id="subscription-form-{{ section.id }}">

  <!-- Step 1: Product Selection -->
  <div class="form-step active" data-step="1">
    <!-- Header -->
    <div class="step-header">
      <div class="header-content">
        <div class="header-left">
          <h2>Select Cuts</h2>
          <p>Add more, save more. You can change your cuts month to month</p>
        </div>
        <div class="header-right">
          <div class="step-indicator">Step 1/2:</div>
          <div class="next-step-info">Next step: Choose Frequency</div>
        </div>
      </div>
    </div>

    <!-- Progress Bar with Milestones -->
    <div class="discount-progress-container">
      <div class="progress-text">Add more, save more</div>
      <div class="progress-bar-wrapper">
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
        <div class="progress-milestones">
          <div class="milestone" data-threshold="6">
            <div class="milestone-dot"></div>
            <div class="milestone-text">Add 6, get 5% OFF</div>
          </div>
          <div class="milestone" data-threshold="10">
            <div class="milestone-dot"></div>
            <div class="milestone-text">Add 10, get 10% OFF</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Products Container -->
    <div class="products-main-container">
      <!-- Categories Sidebar -->
      <div class="categories-sidebar">
        <!-- Categories loaded dynamically -->
      </div>

      <!-- Products Grid (3 columns) -->
      <div class="products-grid-container">
        <div class="products-grid">
          <div class="loading-products">
            <p>Loading products...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Bottom Cart Summary -->
    <div class="floating-cart-summary">
      <div class="cart-summary-left">
        <div class="cart-message" id="cart-message">Choose at least 10 for 10% OFF</div>
        <div class="cart-details" id="cart-details">0 selected: $0.00</div>
      </div>
      <div class="cart-summary-right">
        <button class="select-frequency-btn" id="select-frequency-btn" disabled>Select Frequency</button>
      </div>
    </div>
  </div>

  <!-- Step 2: Frequency Selection -->
  <div class="form-step" data-step="2">
    <div class="frequency-container">
      <h2>How often do you want to receive your box?</h2>
      <p>Pause or cancel anytime</p>
      
      <div class="frequency-options">
        <label class="frequency-option">
          <input type="radio" name="frequency" value="2weeks" id="freq-2weeks">
          <div class="frequency-content">
            <span>Every 2 weeks</span>
          </div>
        </label>

        <label class="frequency-option">
          <input type="radio" name="frequency" value="4weeks" id="freq-4weeks">
          <div class="frequency-content">
            <span>Every 4 weeks</span>
          </div>
        </label>

        <label class="frequency-option">
          <input type="radio" name="frequency" value="6weeks" id="freq-6weeks">
          <div class="frequency-content">
            <span>Every 6 weeks</span>
          </div>
        </label>
      </div>

      <div class="step-navigation">
        <button class="nav-btn prev-btn" data-step="1">Previous</button>
        <button class="nav-btn next-btn" data-step="3" disabled>Next</button>
      </div>
    </div>
  </div>

  <!-- Step 3: One Time Offer -->
  <div class="form-step" data-step="3">
    <div class="offer-container">
      <h2>One Time Offer!</h2>
      <p>Add these exclusive deals to your first box</p>

      <div class="offer-products">
        <!-- Offer products loaded dynamically -->
        <div class="offer-product-card">
          <div class="discount-badge">50% OFF</div>
          <div class="offer-product-image"></div>
          <h3>Product Title</h3>
          <p>Product Description</p>
          <button class="add-to-first-box-btn">Add to First Box</button>
        </div>

        <div class="offer-product-card">
          <div class="discount-badge">50% OFF</div>
          <div class="offer-product-image"></div>
          <h3>Product Title</h3>
          <p>Product Description</p>
          <button class="add-to-first-box-btn">Add to First Box</button>
        </div>

        <div class="offer-product-card">
          <div class="discount-badge">50% OFF</div>
          <div class="offer-product-image"></div>
          <h3>Product Title</h3>
          <p>Product Description</p>
          <button class="add-to-first-box-btn">Add to First Box</button>
        </div>
      </div>

      <div class="email-capture">
        <input type="email" placeholder="Write your email" id="customer-email" class="email-input">
        <p class="email-disclaimer">By continuing, you agree to receive marketing emails and our terms and privacy policy</p>
      </div>

      <div class="final-actions">
        <button class="add-to-cart-btn" id="final-add-to-cart">Add to Cart</button>
        <a href="#" class="skip-offer" id="skip-offer">No thanks, continue without offer</a>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" style="display: none;">
    <div class="loading-spinner"></div>
    <h3>Creating your subscription...</h3>
    <p>Please wait while we process your order</p>
  </div>
</div>

<!-- Load CSS Files -->
{{ 'base-styles.css' | asset_url | stylesheet_tag }}
{{ 'subscription-options.css' | asset_url | stylesheet_tag }}
{{ 'product-selection.css' | asset_url | stylesheet_tag }}
{{ 'summary.css' | asset_url | stylesheet_tag }}

<!-- Load JS Modules -->
<script src="{{ 'main-subscription.js' | asset_url }}" defer></script>
<script src="{{ 'product-manager.js' | asset_url }}" defer></script>
<script src="{{ 'one-time-offer-manager.js' | asset_url }}" defer></script>
<script src="{{ 'cart-manager.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Subscription Builder",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Form Title",
      "default": "Create your subscription"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Form Description",
      "default": "Configure your personalized subscription in simple steps"
    }
  ]
}
{% endschema %}
